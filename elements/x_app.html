<link rel="import" href="../bower_components/paper-button/paper-button.html" />

<polymer-element name="x-app">
  <template>
    <style>
      :host {
        margin: 0;
        padding: 0;
        border: none;
      }
      .wrapper
      {
        margin: 0;  
        padding: 0;
        border: none;

        max-height: 100%;
        overflow: hidden;
      }
      .sidepanel
      {
        position: absolute;
        margin: 0;
        padding: 10px;

        min-width: 240px;

        padding-top: 29px;

        /*background: #444;*/
        /*background: #2A1332;*/
        background: #5E3D46;
        color: #FFF;
        box-shadow: inset 0 0 9px 0px rgba(20, 20, 20, 0.4);

        top: 0;
        left: -100%;

        z-index: 99;
    
        opacity: 0.9;

        transition: all 0.5s ease;

        max-height: 100%;
        overflow-x: hidden;
        overflow-y: scroll;

        box-sizing: border-box;
      }
      .sidepanel-shown
      {
        left: 0%;
      }
/*      @media screen and (max-width: 700px) {
      }*/
      paper-button
      {
        text-transform: none;
        /*color: #4285F4;*/
        color: #35718D;
        /*color: #78ADA5;*/
      }
      paper-icon-button[icon="menu"], paper-icon-button[icon="close"]
      {
        position: absolute;
        top: 0;
        left: 0;
      }
      .app
      {
          display: flex;
          flex-flow: column nowrap;
          justify-content: center;
          align-items: center;
          align-content: center;
      }
      .buttons
      {
        display: flex;
        flex-flow: row nowrap;
        justify-content: center;
        align-items: center;
        align-content: center;
      }
      #sidepanelTouchTarget
      {
        position: absolute;
        margin: 0;
        padding: 0;
        width: 24px;
        height: 100%;
        border: none;
        background: none;
        z-index: 2;
      }
    </style>
    <div class="wrapper">
      <div id="sidepanelTouchTarget"></div>
      <div id="sidepanel" class="sidepanel">
        <paper-icon-button icon="close" on-click="{{showSidepanel}}" ></paper-icon-button>
        <constellations-list id="constellationsList0" currentkey="{{currentkey}}" on-select="{{selectConstellation}}"></constellations-list>
        <constellations-list id="constellationsList1" currentkey="{{currentkey}}" on-select="{{selectConstellation}}"></constellations-list>
      </div>
      <div class="app">
          <paper-icon-button id="menu" icon="menu" on-click="{{showSidepanel}}" ></paper-icon-button> 
          <paper-button on-click="{{showSidepanel}}">
            <h1 id="chordTitle">{{currentkey}}{{currentConstellation.name}}</h1>
          </paper-button>
          <div style="width: 250px; height: 250px; margin: 50px; cursor: pointer;">
            <pitch-clock on-change="{{pitchClockChange}}" id="pitchClock"></pitch-clock>
          </div>
          <div class="buttons">
            <paper-button on-click="{{playInOrder}}">
              <core-icon icon="av:volume-down"></core-icon>
            </paper-button>
            <paper-button on-click="{{playAll}}">
              <core-icon icon="av:volume-up"></core-icon>
            </paper-button>
          </div>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      ready: function() {
        var _this = this;

        this.libraries = window.libraries;
        this.$.constellationsList0.library = this.libraries[0];
        this.$.constellationsList1.library = this.libraries[1];

        this.currentkey = 'A';
        this.currentConstellation = window.libraries[0].constellations[0];

        console.log('currentConstellation ');
        this.$.pitchClock.setFromConstellation(this.currentConstellation, {normalize: true});

        //this.data = new Map();

        if (window.innerWidth >= 700) {
          this.showSidepanel();
        }

        // this.$.sidepanelTouchTarget.addEventListener('mousedown', function() {
        //    _this.showSidepanel(); 
        // });

        this.$.sidepanelTouchTarget.addEventListener('touchstart', function() {
            _this.showSidepanel(true); 
        });
        // this.$.sidepanel.addEventListener('touchleave', function() {
        //   if (this.shown) {
        //     console.log('touchleave');
        //     _this.showSidepanel();
        //   } 
        // });
      },
      playInOrder: function() {
        this.$.pitchClock.playInOrder();
      },
      playAll: function() {
        this.$.pitchClock.toggle();
      },
      showSidepanel: function(val) {
        console.log('show');
        if (this.shown || (val !== true)) {
          this.$.menu.style.opacity = 1;
          this.$.sidepanel.classList.remove('sidepanel-shown');
          this.shown = false;
        } else {
          this.$.menu.style.opacity = 0;
          this.$.sidepanel.classList.add('sidepanel-shown');
          this.shown = true;
        }
      },
      set: function(key, val) {
        this.data.set(key, val);
        this.fire('change');
      },
      get: function(key) {
        return this.data.get(key);
      },
      selectConstellation: function(ev) {
        console.log('select constellation');

        if (window.innerWidth < 700) {
          this.showSidepanel();
        }

        // var constellation = {
        //   name: ev.detail.name,
        //   longName: ev.detail.longname,
        //   semitones: ev.detail.semitones,
        //   temperament: ev.detail.temperament
        // };
        var constellation = ev.detail.constellation;

        //this.pitchClockEl.setFromConstellation({
        this.$.pitchClock.setFromConstellation(constellation, {normalize: true});

        this.currentConstellation = constellation;
      },
      pitchClockChange: function() {
        console.log('pitch clock change');
      }
    });
  </script>
</polymer-element>